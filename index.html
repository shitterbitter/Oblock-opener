<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Block Case Opening</title>
<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: url('https://upload.wikimedia.org/wikipedia/commons/8/81/Parkway_Gardens_Chicago.jpg') no-repeat center center fixed;
  background-size: cover;
  overflow: hidden;
}
.overlay {
  position: relative;
  background: rgba(0,0,0,0.65);
  color: #fff;
  padding: 40px 20px;
  min-height: 100vh;
  box-sizing: border-box;
}
h1, h2 { text-align: center; margin-bottom: 20px; }
#canvasContainer {
  position: relative;
  width: 320px;
  height: 80px;
  margin: 0 auto 20px;
  border-radius: 10px;
  overflow: hidden;
  background: rgba(255,255,255,0.1);
}
#reelCanvas {
  display: block;
}
.indicator {
  position: absolute;
  top: 0;
  left: 50%;
  width: 80px;
  height: 100%;
  margin-left: -40px;
  border: 2px solid #ffd36b;
  pointer-events: none;
}
.btn {
  display: inline-block;
  background: linear-gradient(180deg,#ffd36b,#b8860b);
  color:#111;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
  margin:5px;
  font-size: 1rem;
}
.inventory {
  margin-top: 20px;
  max-width: 600px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
.item {
  padding: 8px 12px;
  border-radius: 8px;
  font-weight: 600;
  text-align: center;
  min-width: 60px;
  cursor: pointer;
  user-select: none;
}
.item.selected { outline: 2px solid #ffd36b; }
.grey { background-color: #7d7d7d; color: #fff; }
.blue { background-color: #3498db; color: #fff; }
.purple { background-color: #9b59b6; color: #fff; }
.red { background-color: #e74c3c; color: #fff; }
.gold { background-color: #ffd700; color: #111; }
.gamble-section { margin-top: 50px; text-align: center; }
</style>
</head>
<body>
<div class="overlay">
  <h1>O Block Case Opening</h1>
  <div id="canvasContainer">
    <canvas id="reelCanvas" width="320" height="80"></canvas>
    <div class="indicator"></div>
  </div>
  <div style="text-align:center;">
    <button class="btn" id="spinBtn">Spin Case</button>
  </div>
  <h2>Inventory</h2>
  <div class="inventory" id="inventory"></div>
  <div class="gamble-section">
    <h2>Gamble Selected Items</h2>
    <button class="btn" id="gambleBtn">Gamble</button>
  </div>
</div>

<script>
const itemsByRarity = {
  grey: [{name:'Pistol', emoji:'🔫'}, {name:'Shotgun', emoji:'🛠️'}, {name:'SMG', emoji:'🟡'}],
  blue: [{name:'Pistol', emoji:'🔫'}, {name:'SMG', emoji:'🟡'}, {name:'AR', emoji:'🔰'}],
  purple: [{name:'Pistol', emoji:'🔫'}, {name:'SMG', emoji:'🟡'}, {name:'Shotgun', emoji:'🛠️'}, {name:'AR', emoji:'🔰'}],
  red: [{name:'AR', emoji:'🔰'}, {name:'Sniper', emoji:'🎯'}],
  gold: [{name:'Knife', emoji:'🔪'}, {name:'Gloves', emoji:'🧤'}]
};

const rarityChances = [
  {rarity:'grey', chance:0.45},
  {rarity:'blue', chance:0.35},
  {rarity:'purple', chance:0.17},
  {rarity:'red', chance:0.025},
  {rarity:'gold', chance:0.005}
];

let inventory = [];
const canvas = document.getElementById('reelCanvas');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');
const gambleBtn = document.getElementById('gambleBtn');
const inventoryEl = document.getElementById('inventory');

function weightedRarity() {
  const r = Math.random();
  let sum = 0;
  for(const w of rarityChances){
    sum += w.chance;
    if(r < sum) return w.rarity;
  }
  return 'grey';
}

function getRandomItem(){
  const rarity = weightedRarity();
  const pool = itemsByRarity[rarity];
  const item = pool[Math.floor(Math.random()*pool.length)];
  return {...item, rarity};
}

function updateInventory(){
  inventoryEl.innerHTML='';
  inventory.forEach((item,index)=>{
    const div=document.createElement('div');
    div.className='item '+item.rarity;
    div.textContent=item.emoji+' '+item.name;
    div.dataset.index=index;
    div.addEventListener('click',()=>div.classList.toggle('selected'));
    inventoryEl.appendChild(div);
  });
}

// CANVAS SPIN
function spinCase(){
  spinBtn.disabled = true;
  const finalItem = getRandomItem();
  const itemWidth = 80;
  const totalItems = 30;
  let items = [];
  for(let i=0;i<totalItems;i++){
    items.push(getRandomItem());
  }
  items.push(finalItem); // final item at end

  let posX = 0;
  let start = null;
  const duration = 5000;

  function animate(timestamp){
    if(!start) start=timestamp;
    const progress = Math.min((timestamp-start)/duration,1);
    const ease = 1 - Math.pow(1-progress,3); // easing out
    posX = ease * (itemWidth * (items.length - 1) - (canvas.width/2 - itemWidth/2));

    // draw canvas
    ctx.clearRect(0,0,canvas.width,canvas.height);
    items.forEach((item,i)=>{
      const x = i*itemWidth - posX;
      ctx.fillStyle = getColor(item.rarity);
      ctx.fillRect(x+2, 10, itemWidth-4, 60);
      ctx.fillStyle = "#fff";
      ctx.font="30px sans-serif";
      ctx.textAlign="center";
      ctx.textBaseline="middle";
      ctx.fillText(item.emoji,x+itemWidth/2,40);
    });

    if(progress<1){
      requestAnimationFrame(animate);
    }else{
      inventory.push(finalItem);
      updateInventory();
      spinBtn.disabled=false;
    }
  }

  requestAnimationFrame(animate);
}

function getColor(rarity){
  switch(rarity){
    case 'grey': return '#7d7d7d';
    case 'blue': return '#3498db';
    case 'purple': return '#9b59b6';
    case 'red': return '#e74c3c';
    case 'gold': return '#ffd700';
    default: return '#fff';
  }
}

// GAMBLING
function gambleItems(){
  const selected=Array.from(inventoryEl.querySelectorAll('.item.selected'));
  if(selected.length===0) return alert("Select items to gamble!");
  const n = selected.length;

  const odds = {
    grey: 0.45,
    blue: 0.35 + n*0.01,
    purple: 0.17 + n*0.005,
    red: 0.025 + n*0.001,
    gold: 0.005 + n*0.0005
  };

  let sum=0;
  for(const k in odds) sum+=odds[k];
  for(const k in odds) odds[k]/=sum;

  function weightedGambleRarity(){
    const r=Math.random();
    let total=0;
    for(const k in odds){
      total+=odds[k];
      if(r<total) return k;
    }
    return 'grey';
  }

  const rarity = weightedGambleRarity();
  const pool = itemsByRarity[rarity];
  const newItem = pool[Math.floor(Math.random()*pool.length)];

  const indexes = selected.map(el=>parseInt(el.dataset.index)).sort((a,b)=>b-a);
  indexes.forEach(i=>inventory.splice(i,1));

  inventory.push({...newItem, rarity});
  updateInventory();
  alert("Gambled and received: "+newItem.emoji+" "+newItem.name+" ("+rarity+")");
}

spinBtn.addEventListener('click',spinCase);
gambleBtn.addEventListener('click',gambleItems);

updateInventory();
</script>
</body>
</html>

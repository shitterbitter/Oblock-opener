<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Block Case Opening</title>
<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: #111;
  color: #fff;
  overflow-x: hidden;
}
.overlay {
  position: relative;
  background: #000;
  border: 2px solid orange;
  color: orange;
  padding: 40px 20px;
  min-height: 100vh;
  text-align: center;
}
h1, h2 { color: orange; margin-bottom: 20px; }
.roller-container {
  position: relative;
  width: 400px;
  height: 100px;
  overflow: hidden;
  margin: 20px auto;
  border-radius: 12px;
  border: 2px solid orange;
  background: #111;
}
.reel {
  display: flex;
  align-items: center;
  height: 100%;
  will-change: transform;
}
.reel span {
  min-width: 100px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  flex-shrink: 0;
  margin: 0 2px;
  border-radius: 8px;
  font-weight: 800;
}
.indicator {
  position: absolute;
  top: 0;
  left: 50%;
  width: 100px;
  height: 100%;
  margin-left: -50px;
  border: 3px solid orange;
  pointer-events: none;
}
.btn {
  display: inline-block;
  background: orange;
  color:#111;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
  margin:5px;
  font-size: 1rem;
}
.inventory {
  margin-top: 30px;
  max-width: 800px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  border-top: 2px solid orange;
  padding-top: 10px;
}
.item {
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 600;
  min-width: 70px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  border: 2px solid orange;
}
.item.selected { outline: 2px solid #fff; }
.grey { background-color: #444; color: #fff; }
.blue { background-color: #ff8c00; color: #111; }
.purple { background-color: #8b00ff; color: #fff; }
.red { background-color: #e74c3c; color: #fff; }
.gold { background-color: #ffd700; color: #111; }
.gamble-section { margin-top: 50px; }
</style>
</head>
<body>
<div class="overlay">
  <h1>O Block Case Opening</h1>
  <div class="roller-container">
    <div class="reel" id="reel"></div>
    <div class="indicator"></div>
  </div>
  <div>
    <button class="btn" id="spinBtn">Open Case</button>
  </div>
  <h2>Inventory</h2>
  <div class="inventory" id="inventory"></div>
  <div class="gamble-section">
    <h2>Gamble Selected Items</h2>
    <button class="btn" id="gambleBtn">Gamble</button>
  </div>
</div>

<script>
const itemsByRarity = {
  grey: [{name:'Pistol', emoji:'🔫'}, {name:'Shotgun', emoji:'🛠️'}, {name:'SMG', emoji:'🟡'}],
  blue: [{name:'Pistol', emoji:'🔫'}, {name:'SMG', emoji:'🟡'}, {name:'AR', emoji:'🔰'}],
  purple: [{name:'Pistol', emoji:'🔫'}, {name:'SMG', emoji:'🟡'}, {name:'Shotgun', emoji:'🛠️'}, {name:'AR', emoji:'🔰'}],
  red: [{name:'AR', emoji:'🔰'}, {name:'Sniper', emoji:'🎯'}],
  gold: [{name:'Knife', emoji:'🔪'}, {name:'Gloves', emoji:'🧤'}]
};

const rarityChances = [
  {rarity:'grey', chance:0.45},
  {rarity:'blue', chance:0.35},
  {rarity:'purple', chance:0.17},
  {rarity:'red', chance:0.025},
  {rarity:'gold', chance:0.005}
];

let inventory = [];
const reelEl = document.getElementById('reel');
const inventoryEl = document.getElementById('inventory');
const spinBtn = document.getElementById('spinBtn');
const gambleBtn = document.getElementById('gambleBtn');

function weightedRarity() {
  const r = Math.random();
  let sum = 0;
  for(const w of rarityChances){
    sum += w.chance;
    if(r < sum) return w.rarity;
  }
  return 'grey';
}

function getRandomItem() {
  const rarity = weightedRarity();
  const pool = itemsByRarity[rarity];
  const item = pool[Math.floor(Math.random()*pool.length)];
  return {...item, rarity};
}

function updateInventory() {
  inventoryEl.innerHTML = '';
  inventory.forEach((item,index)=>{
    const div = document.createElement('div');
    div.className = 'item ' + item.rarity;
    div.textContent = item.emoji + ' ' + item.name;
    div.dataset.index = index;
    div.addEventListener('click',()=>div.classList.toggle('selected'));
    inventoryEl.appendChild(div);
  });
}

function spinCase() {
  spinBtn.disabled = true;
  const finalItem = getRandomItem();
  const itemWidth = 100;
  const visibleSlots = 4;
  const totalSlots = 40;
  const reelArray = [];

  for(let i=0;i<totalSlots;i++){
    reelArray.push(getRandomItem());
  }
  reelArray.push(finalItem);

  reelEl.innerHTML='';
  reelArray.forEach(item=>{
    const span = document.createElement('span');
    span.textContent = item.emoji;
    span.className = item.rarity;
    reelEl.appendChild(span);
  });

  const duration = 5000;
  let start = null;

  function animate(timestamp){
    if(!start) start = timestamp;
    const progress = Math.min((timestamp-start)/duration,1);
    const ease = 1 - Math.pow(1-progress,3);
    const offset = ease * (reelArray.length-1) * itemWidth - (visibleSlots/2*itemWidth - itemWidth/2);
    reelEl.style.transform = `translateX(-${offset}px)`;

    if(progress < 1){
      requestAnimationFrame(animate);
    } else {
      inventory.push(finalItem);
      updateInventory();
      spinBtn.disabled = false;
    }
  }

  requestAnimationFrame(animate);
}

function gambleItems(){
  const selected = Array.from(inventoryEl.querySelectorAll('.item.selected'));
  if(selected.length === 0) return alert("Select items to gamble!");
  const n = selected.length;

  const odds = {
    grey: 0.45,
    blue: 0.35 + n*0.01,
    purple: 0.17 + n*0.005,
    red: 0.025 + n*0.001,
    gold: 0.005 + n*0.0005
  };

  let sum = 0;
  for(const k in odds) sum += odds[k];
  for(const k in odds) odds[k] /= sum;

  function weightedGambleRarity(){
    const r = Math.random();
    let total = 0;
    for(const k in odds){
      total += odds[k];
      if(r < total) return k;
    }
    return 'grey';
  }

  const rarity = weightedGambleRarity();
  const pool = itemsByRarity[rarity];
  const newItem = pool[Math.floor(Math.random()*pool.length)];

  const indexes = selected.map(el => parseInt(el.dataset.index)).sort((a,b)=>b-a);
  indexes.forEach(i => inventory.splice(i,1));

  inventory.push({...newItem, rarity});
  updateInventory();
  alert("Gambled and received: " + newItem.emoji + " " + newItem.name + " (" + rarity + ")");
}

spinBtn.addEventListener('click', spinCase);
gambleBtn.addEventListener('click', gambleItems);
updateInventory();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>O Block Case Opening</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: url('https://upload.wikimedia.org/wikipedia/commons/8/81/Parkway_Gardens_Chicago.jpg') no-repeat center center fixed;
  background-size: cover;
  height: 100vh;
  overflow-x: hidden;
}
.overlay {
  position: relative;
  background: rgba(0,0,0,0.65);
  color: #fff;
  padding: 40px 20px;
  min-height: 100vh;
}
h1, h2 {
  text-align: center;
  margin-bottom: 20px;
}
.roller-container {
  position: relative;
  width: 320px;
  height: 80px;
  overflow: hidden;
  margin: 0 auto 20px;
  border-radius: 10px;
  background: rgba(255,255,255,0.1);
}
.reel {
  display: flex;
  flex-direction: row;
  align-items: center;
  height: 100%;
  will-change: transform;
}
.reel span {
  min-width: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  flex-shrink: 0;
}
.indicator {
  position: absolute;
  top: 0;
  left: 50%;
  width: 80px;
  height: 100%;
  margin-left: -40px;
  border: 2px solid #ffd36b;
  pointer-events: none;
}
.btn {
  background: linear-gradient(180deg,#ffd36b,#b8860b);
  color:#111;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
  margin:5px;
  font-size: 1rem;
}
.inventory {
  margin-top: 20px;
  max-width: 600px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
.item {
  padding: 8px 12px;
  border-radius: 8px;
  font-weight: 600;
  text-align: center;
  min-width: 60px;
  cursor: pointer;
  user-select: none;
}
.item.selected {
  outline: 2px solid #ffd36b;
}
.grey { background-color: #7d7d7d; color: #fff; }
.blue { background-color: #3498db; color: #fff; }
.purple { background-color: #9b59b6; color: #fff; }
.red { background-color: #e74c3c; color: #fff; }
.gold { background-color: #ffd700; color: #111; }
.gamble-section {
  margin-top: 50px;
  text-align: center;
}
</style>
</head>
<body>
<div class="overlay">
  <h1>O Block Case Opening</h1>
  <div class="roller-container">
    <div class="reel" id="reel"></div>
    <div class="indicator"></div>
  </div>
  <div style="text-align:center;">
    <button class="btn" id="spinBtn">Spin Case</button>
  </div>
  <h2>Inventory</h2>
  <div class="inventory" id="inventory"></div>
  <div class="gamble-section">
    <h2>Gamble Selected Items</h2>
    <button class="btn" id="gambleBtn">Gamble</button>
  </div>
</div>

<script>
const items = [
  {name:'Pistol', emoji:'üî´', rarities:['grey','blue','purple']},
  {name:'SMG', emoji:'üü°', rarities:['blue','purple']},
  {name:'Shotgun', emoji:'üõ†Ô∏è', rarities:['grey','blue','purple']},
  {name:'AR', emoji:'üî∞', rarities:['purple','red']},
  {name:'Sniper', emoji:'üéØ', rarities:['red']},
  {name:'Gloves', emoji:'üß§', rarities:['gold']},
  {name:'Knife', emoji:'üî™', rarities:['gold']}
];

// Base probabilities
const baseRarityWeights = { grey:0.5, blue:0.3, purple:0.15, red:0.04, gold:0.01 };
let inventory = [];

const reelEl = document.getElementById('reel');
const inventoryEl = document.getElementById('inventory');
const spinBtn = document.getElementById('spinBtn');
const gambleBtn = document.getElementById('gambleBtn');

function weightedRandom(weights) {
  const r = Math.random();
  let sum=0;
  for(let k in weights){ sum+=weights[k]; if(r<sum) return k; }
  return 'grey';
}

function getRandomItem(rarityWeights=baseRarityWeights) {
  const rarity = weightedRandom(rarityWeights);
  const possible = items.filter(i=>i.rarities.includes(rarity));
  return {...possible[Math.floor(Math.random()*possible.length)], rarity};
}

function updateInventory(){
  inventoryEl.innerHTML='';
  inventory.forEach((item,index)=>{
    const div=document.createElement('div');
    div.className='item '+item.rarity;
    div.textContent=item.emoji+' '+item.name;
    div.dataset.index=index;
    div.addEventListener('click',()=>div.classList.toggle('selected'));
    inventoryEl.appendChild(div);
  });
}

// Prebuild reel and animate
function spinCase(){
  spinBtn.disabled=true;
  const finalItem=getRandomItem();
  reelEl.innerHTML='';
  const totalSlots=50; // long reel for smooth spin
  const reelArray=[];
  for(let i=0;i<totalSlots;i++){
    reelArray.push(items[Math.floor(Math.random()*items.length)]);
  }
  reelArray.push(finalItem); // final item last
  reelArray.forEach(item=>{
    const span=document.createElement('span');
    span.textContent=item.emoji;
    reelEl.appendChild(span);
  });

  // Calculate transform so final item is centered
  const centerIndex=totalSlots;
  const transformX=centerIndex*80 - 120; // 120 = half of container (320/2)
  setTimeout(()=>{
    reelEl.style.transition='transform 5s cubic-bezier(0.25,1,0.5,1)';
    reelEl.style.transform=`translateX(-${transformX}px)`;
  },50);

  setTimeout(()=>{
    inventory.push(finalItem);
    updateInventory();
    spinBtn.disabled=false;
    reelEl.style.transition='none';
    reelEl.style.transform='translateX(0)';
  },5100);
}

// Gamble system with realistic odds
function gambleItems(){
  const selected=Array.from(inventoryEl.querySelectorAll('.item.selected'));
  if(selected.length===0) return alert("Select items to gamble!");

  const totalRarity=selected.reduce((sum,el)=>{
    const item=inventory[el.dataset.index];
    switch(item.rarity){
      case 'grey': return sum+1;
      case 'blue': return sum+2;
      case 'purple': return sum+3;
      case 'red': return sum+4;
      case 'gold': return sum+5;
    }
    return sum;
  },0);

  // Adjusted odds: greys very common, gold extremely rare
  let weights={
    grey: Math.min(0.7,0.5+0.01*totalRarity),
    blue: Math.min(0.25,0.3+0.005*totalRarity),
    purple: Math.min(0.15,0.15+0.003*totalRarity),
    red: Math.min(0.08,0.04+0.001*totalRarity),
    gold: Math.min(0.02,0.01+0.0005*totalRarity)
  };

  const newItem=getRandomItem(weights);
  const indexesToRemove=selected.map(el=>parseInt(el.dataset.index)).sort((a,b)=>b-a);
  indexesToRemove.forEach(i=>inventory.splice(i,1));

  inventory.push(newItem);
  updateInventory();
  alert("Gambled and received: "+newItem.emoji+" "+newItem.name+" ("+newItem.rarity+")");
}

spinBtn.addEventListener('click',spinCase);
gambleBtn.addEventListener('click',gambleItems);

updateInventory();
</script>
</body>
</html>

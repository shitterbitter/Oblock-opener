<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸ’° Case Opening Go</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --royal-blue-1:#062a52;
  --royal-blue-2:#1b4f84;
  --gold-1:#ffd36b;
  --gold-2:#b8860b;
  --accent:#ff9900;
  --bg-dark:#1e1e2f;
}

/* General reset */
html,body{
  margin:0;
  height:100%;
  font-family:'Inter',sans-serif;
  overflow-x:hidden;
  background:linear-gradient(135deg,var(--royal-blue-1),var(--royal-blue-2));
  color:#fff;
}

/* Sparkle canvas */
#sparkleCanvas{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:0;}

/* Main container */
.container{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:24px;
  text-align:center;
  z-index:1;
  position:relative;
}

/* Roller panel */
.roller-panel{
  margin-top:40px;
  padding:28px 20px;
  border-radius:14px;
  background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.06);
  backdrop-filter:blur(6px);
  box-shadow:0 18px 40px rgba(0,0,0,0.45);
  width:fit-content;
}

/* Roller */
.roller-container {
  position: relative;
  width: 400px;
  height: 100px;
  overflow: hidden;
  margin: 20px auto;
  border-radius: 16px;
  border: 2px solid var(--accent);
  background: var(--bg-dark);
  box-shadow: inset 0 0 10px rgba(255,153,0,0.3);
}
.reel {
  display:flex;
  align-items:center;
  height:100%;
  will-change: transform;
}
.reel span {
  min-width:100px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2.5rem;
  flex-shrink:0;
  margin:0 2px;
  border-radius:12px;
  font-weight:800;
  box-shadow: 0 0 5px rgba(0,0,0,0.5);
  position: relative;
}
.reel span .cond {
  position: absolute;
  top: 4px;
  right: 6px;
  font-size:0.7rem;
  font-weight:800;
  color:#fff;
}
.indicator {
  position:absolute;
  top:0;
  left:50%;
  width:100px;
  height:100%;
  margin-left:-50px;
  border:3px solid var(--accent);
  pointer-events:none;
  box-shadow: 0 0 10px var(--accent);
}

/* Inventory */
.inventory{
  margin-top:30px;
  max-width:800px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  border-top:2px solid var(--accent);
  padding-top:10px;
}
.item{
  padding:10px 14px;
  border-radius:12px;
  font-weight:600;
  min-width:70px;
  text-align:center;
  cursor:pointer;
  user-select:none;
  border:2px solid var(--accent);
  box-shadow: 0 0 8px rgba(0,0,0,0.5);
  position: relative;
}
.item .cond{
  position: absolute;
  top:4px;
  right:6px;
  font-size:0.7rem;
  font-weight:800;
  color:#fff;
}
.item.selected{outline:2px solid #fff;}
.grey { background-color:#555;color:#fff; }
.blue { background-color:#1e90ff;color:#fff; }
.purple { background-color:#8b00ff;color:#fff; }
.red { background-color:#e74c3c;color:#fff; }
.gold { background-color:#ffd700;color:#111; }

/* Buttons */
.btn{
  background:linear-gradient(180deg,var(--gold-1),var(--gold-2));
  color:#111;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  font-weight:800;
  cursor:pointer;
  box-shadow:0 10px 30px rgba(184,134,11,0.12);
  margin:5px;
}
.btn:active{transform:translateY(1px) scale(.995);}

/* Story section */
.story{
  max-width:820px;
  margin:40px auto;
  padding:36px 22px;
  background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.03);
  opacity:0;
  transform:translateY(20px);
  transition:opacity .6s ease,transform .6s ease;
}
.story.visible{opacity:1;transform:none;}
.story h2{color:var(--gold-1);margin:0 0 10px;font-size:1.8rem;}
</style>
</head>
<body>

<canvas id="sparkleCanvas"></canvas>

<div class="container">
  <h1>ðŸ’¥ Case Opening Go</h1>
  
  <div class="roller-panel">
    <div class="roller-container">
      <div class="reel" id="reel"></div>
      <div class="indicator"></div>
    </div>
    <button class="btn" id="spinBtn">Open Case</button>
    
    <h2>Inventory</h2>
    <div class="inventory" id="inventory"></div>
    <div class="gamble-section">
      <h2>Gamble Selected Items</h2>
      <button class="btn" id="gambleBtn">Gamble</button>
    </div>
  </div>
</div>

<div class="story" id="story">
  <h2>ðŸ’› Gold Gold Gold!</h2>
  <p>Step into the world of cases, where patience and trust in luck is tested. Collect weapons and items, gamble wisely and get the best inventory in the world!</p>
</div>

<script>
// Sparkles
const canvas=document.getElementById('sparkleCanvas');
const ctx=canvas.getContext('2d');
function sizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
sizeCanvas();
const sparkles=[];
for(let i=0;i<100;i++){sparkles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+0.6,speed:Math.random()*0.35+0.05,opacity:Math.random()*0.7+0.2});}
function animateSparkles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const s of sparkles){
    ctx.beginPath();
    ctx.fillStyle=`rgba(255,215,130,${s.opacity})`;
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
    s.y-=s.speed;
    if(s.y<-8){s.y=canvas.height+6;s.x=Math.random()*canvas.width;}
  }
  requestAnimationFrame(animateSparkles);
}
animateSparkles();
window.addEventListener('resize',sizeCanvas);

// Story
const story=document.getElementById('story');
story.classList.add('visible');

// Case opener logic
const itemsByRarity = {
  grey: [{name:'Pistol',emoji:'ðŸ”«'},{name:'Shotgun',emoji:'ðŸ› ï¸'},{name:'SMG',emoji:'ðŸŸ¡'}],
  blue: [{name:'Pistol',emoji:'ðŸ”«'},{name:'SMG',emoji:'ðŸŸ¡'},{name:'AR',emoji:'ðŸ”°'}],
  purple: [{name:'Pistol',emoji:'ðŸ”«'},{name:'SMG',emoji:'ðŸŸ¡'},{name:'Shotgun',emoji:'ðŸ› ï¸'},{name:'AR',emoji:'ðŸ”°'}],
  red: [{name:'AR',emoji:'ðŸ”°'},{name:'Sniper',emoji:'ðŸŽ¯'}],
  gold: [{name:'Knife',emoji:'ðŸ”ª'},{name:'Gloves',emoji:'ðŸ§¤'}]
};
const rarityChances=[
  {rarity:'grey',chance:0.45},
  {rarity:'blue',chance:0.35},
  {rarity:'purple',chance:0.17},
  {rarity:'red',chance:0.025},
  {rarity:'gold',chance:0.005}
];

const conditions=['FT','WW','MW','FN'];
const conditionChances=[0.35,0.30,0.25,0.10]; // most common to rarest

let inventory=[];
const reelEl=document.getElementById('reel');
const inventoryEl=document.getElementById('inventory');
const spinBtn=document.getElementById('spinBtn');
const gambleBtn=document.getElementById('gambleBtn');

function weightedRarity(){
  const r=Math.random();
  let sum=0;
  for(const w of rarityChances){
    sum+=w.chance;
    if(r<sum) return w.rarity;
  }
  return 'grey';
}

function weightedCondition(){
  const r=Math.random();
  let sum=0;
  for(let i=0;i<conditions.length;i++){
    sum+=conditionChances[i];
    if(r<sum) return conditions[i];
  }
  return 'FT';
}

function getRandomItemForRarity(rarity){
  const pool=itemsByRarity[rarity];
  const item=pool[Math.floor(Math.random()*pool.length)];
  return {...item, rarity, cond:weightedCondition()};
}

function updateInventory(){
  inventoryEl.innerHTML='';
  inventory.forEach((item,index)=>{
    const div=document.createElement('div');
    div.className='item '+item.rarity;
    div.textContent=item.emoji+' '+item.name;
    const condSpan=document.createElement('span');
    condSpan.className='cond';
    condSpan.textContent=item.cond;
    div.appendChild(condSpan);
    div.dataset.index=index;
    div.addEventListener('click',()=>div.classList.toggle('selected'));
    inventoryEl.appendChild(div);
  });
}

function generateRollerArray(totalSlots=40){
  const finalRarity=weightedRarity();
  const finalItem=getRandomItemForRarity(finalRarity);
  const array=[];
  for(let i=0;i<totalSlots;i++){
    const r=weightedRarity();
    array.push(getRandomItemForRarity(r));
  }
  const midIndex=Math.floor(totalSlots/2);
  array[midIndex]=finalItem; // ensure snap
  return {array, finalItem, midIndex};
}

function spinCase(){
  spinBtn.disabled=true;

  // Hide reel for 0.5s to prevent outcome preview
  reelEl.style.visibility='hidden';
  setTimeout(()=>{
    reelEl.style.visibility='visible';

    const {array: reelArray, finalItem, midIndex} = generateRollerArray();
    reelEl.innerHTML='';
    reelArray.forEach(item=>{
      const span=document.createElement('span');
      span.textContent=item.emoji;
      span.className=item.rarity;
      reelEl.appendChild(span);
    });

    const duration=5000;
    const itemWidth=100;
    let start=null;

    function animate(timestamp){
      if(!start) start=timestamp;
      const progress=Math.min((timestamp-start)/duration,1);
      const ease=1-Math.pow(1-progress,3);
      const offset=ease*(reelArray.length-1)*itemWidth - midIndex*itemWidth;
      reelEl.style.transform=`translateX(-${offset}px)`;
      if(progress<1) requestAnimationFrame(animate);
      else{
        inventory.push(finalItem);
        updateInventory();
        spinBtn.disabled=false;
      }
    }
    requestAnimationFrame(animate);

  },500);
}

function gambleItems(){
  const selected=Array.from(inventoryEl.querySelectorAll('.item.selected'));
  if(selected.length===0) return alert("Select items to gamble!");
  const n=selected.length;
  
  // Determine min rarity among selected
  const raritiesOrder=['grey','blue','purple','red','gold'];
  let minIndex=Math.min(...selected.map(div=>raritiesOrder.indexOf(inventory[div.dataset.index].rarity)));

  // Odds calculation
  let odds={grey:0,blue:0.35, purple:0.17, red:0.025, gold:0.005};
  raritiesOrder.forEach((r,i)=>{if(i<minIndex) odds[r]=0;});
  // Increase chance slightly with more items
  raritiesOrder.forEach(r=>{odds[r]+=n*0.002;});
  // Normalize
  let sum=0;
  for(const k in odds) sum+=odds[k];
  for(const k in odds) odds[k]/=sum;

  function weightedGambleRarity(){
    const r=Math.random();
    let total=0;
    for(const k in odds){
      total+=odds[k];
      if(r<total) return k;
    }
    return raritiesOrder[minIndex];
  }

  const rarity=weightedGambleRarity();
  const item=getRandomItemForRarity(rarity);

  selected.sort((a,b)=>b.dataset.index-a.dataset.index).forEach(div=>{
    inventory.splice(div.dataset.index,1);
  });
  inventory.push(item);
  updateInventory();

  // Small sparkle around received item
  const el=inventoryEl.lastChild;
  const partCount=20;
  const sparks=[];
  for(let i=0;i<partCount;i++){
    const s=document.createElement('div');
    s.style.position='absolute';
    s.style.width='6px';
    s.style.height='6px';
    s.style.background='#fff';
    s.style.top='50%';
    s.style.left='50%';
    s.style.pointerEvents='none';
    s.style.borderRadius='50%';
    el.appendChild(s);
    sparks.push({
      el:s,
      x:el.offsetWidth/2,
      y:el.offsetHeight/2,
      vx:(Math.random()-0.5)*20,
      vy:(Math.random()-0.5)*20,
      life:30
    });
  }
  function animateSparks(){
    sparks.forEach((p,i)=>{
      p.x+=p.vx;
      p.y+=p.vy;
      p.vy+=0.5;
      p.el.style.transform=`translate(${p.x}px,${p.y}px)`;
      p.life--;
      if(p.life<=0){p.el.remove(); sparks.splice(i,1);}
    });
    if(sparks.length>0) requestAnimationFrame(animateSparks);
  }
  animateSparks();
}

spinBtn.addEventListener('click',spinCase);
gambleBtn.addEventListener('click',gambleItems);
updateInventory();
</script>
</body>
</html>
